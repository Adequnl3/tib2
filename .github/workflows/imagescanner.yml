name: Scan Docker Image CVE

on: 
  workflow_dispatch:
  push:
  pull_request:
    
jobs:
  scan:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 1
      - shell: bash
        run: |
          
          sudo apt update -y 
          sudo apt -y install build-essential
          sudo apt -y install make jq curl
          mkdir -p ~/.docker/cli-plugins && \
          curl https://github.com/docker/scan-cli-plugin/releases/latest/download/docker-scan_linux_amd64 -L -s -S -o ~/.docker/cli-plugins/docker-scan &&\
          chmod +x ~/.docker/cli-plugins/docker-scan
          cd ci/imageScan
          make 
          mkdir scanreport
          cp unified.csv scanreport
          
      - uses: actions/upload-artifact@v3
        with: 
          name: scanreport
          path: ci/imageScan/scanreport/unified.csv

          


      
      




























