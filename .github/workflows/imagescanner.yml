name: Scan Docker Image CVE

on:
  workflow_dispatch:
    inputs:
      image:
        description: 'specify image tag'
        required: true
        type: string

jobs:
  scan:
    runs-on: ubuntu-22.04
    steps:      
      - uses: actions/checkout@v3
        with:
          fetch-depth: 1

      - name: Run Trivy vulnerability scanner
        uses: aquasecurity/trivy-action@7b7aa264d83dc58691451798b4d117d53d21edfe
        with:
          image-ref: 'tykio/tyk-identity-broker:${{inputs.imagetag}}'
          trivy-config: trivy.yaml
